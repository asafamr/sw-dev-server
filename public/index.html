<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Test serivce worker</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
</head>
<body>
    <div>
        <h1>get from sw</h1>
    <div id='fromsw'></div>
    <div>path<input id="swpath"></div>
    <div><button onclick="getsw()">get</button></div>

</div>
    <hr>
    <div>
        <h1>send to sw</h1>
    <div id='fromsw'></div>
    <div>path<input id="swsendpath"></div>
    <div>value<input id="swsendvalue"></div>
    <div><button onclick="sendsw()">set</button></div>

</div>
    <script>
        async function sendsw(){
            const swsendpath = document.getElementById('swsendpath').value;
            const swsendvalue = document.getElementById('swsendvalue').value;
            const res = await fetch('./dev/'+swsendpath, {body:swsendvalue,method:'POST'})
            console.log('sent',res.status)
        }
        async function getsw(){
            const swpath = document.getElementById('swpath').value;
            const res = await fetch('./dev/'+swpath).then(x=>x.text())
            console.log('got',res)

        }
    </script>
    <script type="module">
        let activeReg;
        navigator.serviceWorker.register('sw.js', {
            scope: './dev/'
        }).then(function (registration) {
            return new Promise(function (resolve, reject) {
                if (registration.installing) {
                    registration.installing.addEventListener('statechange', function (e) {
                        if (e.target.state == 'installed') {
                            resolve(registration);
                        } else if (e.target.state == 'redundant') {
                            reject();
                        }
                    });
                } else {
                    resolve(registration);
                }
            });
        }
        ).then((registration) => {
            console.debug('dev server service worker ready')
            activeReg = registration.active;

        }).catch(function (error) {
            console.error('dev server service worker registaertion error', error)
        })
        navigator.serviceWorker.addEventListener('controllerchange', (ev)=>{
            activeReg = ev.target.controller;
        });
    </script>
</body>
</html>